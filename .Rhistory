# Study2
study2 <- omnibus_all %>%
select(rid, name, first, last, w.asian, identity, race, specific.race, citizen, education, education.ord, income, income.ord, match, res.age, res.male, res.income, res.edu, res.citizenship, res.race)
# Study3
study3 <- immigrants_all %>%
select(rid, name, first, last, w.asian, identity, race, specific.race, citizen, education, education.ord, income, income.ord, match, res.age, res.male, res.income, res.edu, res.citizenship, res.race)
# Rename rid -> id, match -> correct
study1 <- df_rename(study1)
study2 <- df_rename(study2)
study3 <- df_rename(study3)
# Save csv files
write.csv(study1, here("data_outputs", "study-1-names.csv"))
write.csv(study2, here("data_outputs", "study-2-names.csv"))
write.csv(study3, here("data_outputs", "study-3-names.csv"))
# Save rds files
write_rds(study1, here("data_outputs", "study-1-names.rds"))
write_rds(study2, here("data_outputs", "study-2-names.rds"))
write_rds(study3, here("data_outputs", "study-3-names.rds"))
# Save the three datasets as an object
save(study1, study2, study3, file = here("data_outputs", "study123.rda"))
# Save the three datasets as a joined dataframe (using full join)
study1 <- study1 %>% mutate(study = "Study1")
study2 <- study2 %>% mutate(study = "Study2")
study3 <- study3 %>% mutate(study = "Study3")
study_combined <- reduce(list(study1, study2, study3), full_join)
# CSV
write_csv(study_combined, here("data_outputs", "study123.csv"))
# RDS
write_rds(study_combined, here("data_outputs", "study123.rds"))
# All
df <- bind_rows(mutate(df2select(immigrants_all), Data = "Study 3"),
mutate(df2select(omnibus_all), Data = "Study 2"),
mutate(df2select(perceptions_all), Data = "Study 1"))
names <- df %>%
group_by(name, first, last, w.asian, identity) %>%
summarise(mean.correct = mean(match),
sd.correct = sd(match))
# CSV
write.csv(names, here("data_outputs", "names.csv"))
# RDS
write_rds(names, here("data_outputs", "names.rds"))
---
title: "Producing the three datasets"
# Chunk 1
if (!require(pacman)) install.packages("pacman")
pacman::p_load(here, # reproducibility
# wrangling
tidyverse,
tools,
jtools,
# data visualization
ggpubr,
viridis,
ggstance,
patchwork,
gridExtra,
ggrepel)
source(here("functions", "utils.R"))
ggplot2::theme_set(ggpubr::theme_pubr())
# Chunk 2
# Get the file names
file_names <- list.files(here("data"))[str_detect(list.files(here("data")), "2021_")]
# Chunk 3
# Import the csv files; Remove the first two rows
## Immigrants
immigrants_df <- read_csv_custom(1)
## Omnibus
omnibus_df <- read_csv_custom(2)
## Name perceptions
perceptions_df <- read_csv_custom(3)
## Name dataset
names_df <- read.csv(here("data", "names.csv"))
# CSV
write_csv(names_df, here("data_outputs", "names.csv"))
# RDS
write_rds(names_df, here("data_outputs", "names.rds"))
# Chunk 4
omnibus_df <-
clean_omnibus_df(omnibus_df)
immigrants_df <- clean_immigrant_df(immigrants_df)
perceptions_df <- clean_perceptions_df(perceptions_df)
# Chunk 5
immigrants_all <- df2comb(immigrants_df, dataset = "immigrants")
omnibus_all <- df2comb(omnibus_df, dataset = "omnibus")
perceptions_all <- df2comb(perceptions_df, dataset = "perceptions")
length(unique(immigrants_all$name))
length(unique(omnibus_all$name))
length(unique(perceptions_all$name))
immigrants_all %>%
count(name) %>%
summarise(mean = mean(n))
omnibus_all %>%
count(name) %>%
summarise(mean = mean(n))
perceptions_all %>%
count(name) %>%
summarise(mean = mean(n))
# Chunk 6
df2plot(immigrants_all) +
plot_annotation(
title = "Study 3",
tag_levels = "A"
)
if (!require(pacman)) install.packages("pacman")
pacman::p_load(here, # reproducibility
# wrangling
tidyverse,
tools,
jtools,
# data visualization
hbrthemes,
ggpubr,
viridis,
ggstance,
patchwork,
gridExtra,
ggrepel)
source(here("functions", "utils.R"))
ggplot2::theme_set(ggpubr::theme_pubr())
if (!require(pacman)) install.packages("pacman")
pacman::p_load(here, # reproducibility
# wrangling
tidyverse,
tools,
jtools,
# data visualization
hrbthemes,
ggpubr,
viridis,
ggstance,
patchwork,
gridExtra,
ggrepel)
source(here("functions", "utils.R"))
ggplot2::theme_set(ggpubr::theme_pubr())
install.packages('hrbrthemes')
# Chunk 1
if (!require(pacman)) install.packages("pacman")
pacman::p_load(here, # reproducibility
# wrangling
tidyverse,
tools,
jtools,
# data visualization
hrbrthemes,
ggpubr,
viridis,
ggstance,
patchwork,
gridExtra,
ggrepel)
source(here("functions", "utils.R"))
ggplot2::theme_set(ggpubr::theme_pubr())
# Chunk 2
# Get the file names
file_names <- list.files(here("data"))[str_detect(list.files(here("data")), "2021_")]
# Chunk 3
# Import the csv files; Remove the first two rows
## Immigrants
immigrants_df <- read_csv_custom(1)
## Omnibus
omnibus_df <- read_csv_custom(2)
## Name perceptions
perceptions_df <- read_csv_custom(3)
## Name dataset
names_df <- read.csv(here("data", "names.csv"))
# CSV
write_csv(names_df, here("data_outputs", "names.csv"))
# RDS
write_rds(names_df, here("data_outputs", "names.rds"))
# Chunk 4
omnibus_df <-
clean_omnibus_df(omnibus_df)
immigrants_df <- clean_immigrant_df(immigrants_df)
perceptions_df <- clean_perceptions_df(perceptions_df)
# Chunk 5
immigrants_all <- df2comb(immigrants_df, dataset = "immigrants")
omnibus_all <- df2comb(omnibus_df, dataset = "omnibus")
perceptions_all <- df2comb(perceptions_df, dataset = "perceptions")
length(unique(immigrants_all$name))
length(unique(omnibus_all$name))
length(unique(perceptions_all$name))
immigrants_all %>%
count(name) %>%
summarise(mean = mean(n))
omnibus_all %>%
count(name) %>%
summarise(mean = mean(n))
perceptions_all %>%
count(name) %>%
summarise(mean = mean(n))
# Chunk 6
df2plot(immigrants_all) +
plot_annotation(
title = "Study 3",
tag_levels = "A"
)
ggsave(file = here("plots", "immigrants_name.png"), width = 12, height = 11, units = "in")
df2plot(omnibus_all) +
plot_annotation(
title = "Study 2",
tag_levels = "A"
)
ggsave(file = here("plots", "omnibus_name.png"), width = 12, height = 11, units = "in")
df2plot(perceptions_all) +
plot_annotation(
title = "Study 1",
tag_levels = "A"
)
ggsave(file = here("plots", "perceptions_name.png"), width = 12, height = 11, units = "in")
# Chunk 7
pooled <- bind_rows(immigrants_all,
omnibus_all,
perceptions_all)
df <- bind_rows(mutate(df2summ(immigrants_all), Data = "Study 3"),
mutate(df2summ(omnibus_all), Data = "Study 2"),
mutate(df2summ(perceptions_all), Data = "Study 1"))
# Chunk 8
df2plot_covariate(immigrants_all) +  plot_annotation(
title = "Study 3",
tag_levels = "A"
)
ggsave(file = here("plots", "immigrants_name_covariate.png"), width = 12, height = 11, units = "in")
df2plot_covariate(omnibus_all) +  plot_annotation(
title = "Study 2",
tag_levels = "A"
)
ggsave(file = here("plots", "omnibus_name_covariate.png"), width = 12, height = 11, units = "in")
# Chunk 9
df2plot_all(df)
df
df %>%
filter(term != "(Intercept)") %>%
mutate(term = recode(term,
"identityAsian or Pacific Islander" = "Asian",
"w.asian" = "Asian (White first name)",
"identityHispanic" =  "Hispanic",
"identityBlack or African American" = "Black"
)) %>%
mutate(model = fct_relevel(model, "Correct (0/1)")) %>%
distinct() %>%
ggplot(aes(x = term, y = estimate, ymax = estimate+(1.96*std.error), ymin = estimate-(1.96*std.error), col = Data, group = Data, label = round(estimate, 2))) +
geom_pointrange(aes(group = Data, color = Data)) +
facet_wrap(~model) +
ggthemes::scale_color_colorblind() +
labs(x = "", y = "",
col = "Datasets") +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed") +
ggrepel::geom_text_repel()
df %>%
filter(term != "(Intercept)") %>%
mutate(term = recode(term,
"identityAsian or Pacific Islander" = "Asian",
"w.asian" = "Asian (White first name)",
"identityHispanic" =  "Hispanic",
"identityBlack or African American" = "Black"
)) %>%
mutate(model = fct_relevel(model, "Correct (0/1)")) %>%
distinct() %>%
ggplot(aes(x = term, y = estimate, ymax = estimate+(1.96*std.error), ymin = estimate-(1.96*std.error), col = Data, group = Data, label = round(estimate, 2))) +
geom_pointrange(aes(group = Data, color = Data)) +
facet_wrap(~model) +
ggthemes::scale_color_colorblind() +
labs(x = "", y = "",
col = "Datasets") +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed")
# Chunk 1
if (!require(pacman)) install.packages("pacman")
pacman::p_load(here, # reproducibility
# wrangling
tidyverse,
tools,
jtools,
# data visualization
hrbrthemes,
ggpubr,
viridis,
ggstance,
patchwork,
gridExtra,
ggrepel)
source(here("functions", "utils.R"))
ggplot2::theme_set(ggpubr::theme_pubr())
# Chunk 2
# Get the file names
file_names <- list.files(here("data"))[str_detect(list.files(here("data")), "2021_")]
# Chunk 3
# Import the csv files; Remove the first two rows
## Immigrants
immigrants_df <- read_csv_custom(1)
## Omnibus
omnibus_df <- read_csv_custom(2)
## Name perceptions
perceptions_df <- read_csv_custom(3)
## Name dataset
names_df <- read.csv(here("data", "names.csv"))
# CSV
write_csv(names_df, here("data_outputs", "names.csv"))
# RDS
write_rds(names_df, here("data_outputs", "names.rds"))
# Chunk 4
omnibus_df <-
clean_omnibus_df(omnibus_df)
immigrants_df <- clean_immigrant_df(immigrants_df)
perceptions_df <- clean_perceptions_df(perceptions_df)
# Chunk 5
immigrants_all <- df2comb(immigrants_df, dataset = "immigrants")
omnibus_all <- df2comb(omnibus_df, dataset = "omnibus")
perceptions_all <- df2comb(perceptions_df, dataset = "perceptions")
length(unique(immigrants_all$name))
length(unique(omnibus_all$name))
length(unique(perceptions_all$name))
immigrants_all %>%
count(name) %>%
summarise(mean = mean(n))
omnibus_all %>%
count(name) %>%
summarise(mean = mean(n))
perceptions_all %>%
count(name) %>%
summarise(mean = mean(n))
# Chunk 6
df2plot(immigrants_all) +
plot_annotation(
title = "Study 3",
tag_levels = "A"
)
ggsave(file = here("plots", "immigrants_name.png"), width = 12, height = 11, units = "in")
df2plot(omnibus_all) +
plot_annotation(
title = "Study 2",
tag_levels = "A"
)
ggsave(file = here("plots", "omnibus_name.png"), width = 12, height = 11, units = "in")
df2plot(perceptions_all) +
plot_annotation(
title = "Study 1",
tag_levels = "A"
)
ggsave(file = here("plots", "perceptions_name.png"), width = 12, height = 11, units = "in")
# Chunk 7
pooled <- bind_rows(immigrants_all,
omnibus_all,
perceptions_all)
df <- bind_rows(mutate(df2summ(immigrants_all), Data = "Study 3"),
mutate(df2summ(omnibus_all), Data = "Study 2"),
mutate(df2summ(perceptions_all), Data = "Study 1"))
# Chunk 8
df2plot_covariate(immigrants_all) +  plot_annotation(
title = "Study 3",
tag_levels = "A"
)
ggsave(file = here("plots", "immigrants_name_covariate.png"), width = 12, height = 11, units = "in")
df2plot_covariate(omnibus_all) +  plot_annotation(
title = "Study 2",
tag_levels = "A"
)
ggsave(file = here("plots", "omnibus_name_covariate.png"), width = 12, height = 11, units = "in")
# Chunk 9
df2plot_all(df)
ggsave(here("plots", "all_name.png"), width = 12, height = 11, units = "in")
# R CRAN packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, glue, purrr, ggthemes, patchwork, ggrepel, ggpubr, estimatr, fastDummies)
ggplot2::theme_set(ggpubr::theme_pubr())
# Custom functions
source(here("functions", "validate.r"))
source(here("functions", "utils.r"))
load(file = here("data_outputs", "study123.rda"))
study23 <- full_join(study2, study3)
study23 <- study23 %>%
mutate(identity = recode(identity,
"Black or African American" = "Black",
"Asian or Pacific Islander" = "AAPI",
"Hispanic" = "Latino"
))
study123 <- full_join(study1, study2) %>%
full_join(study3)
race_dummies <- study123 %>%
select(race) %>%
dummy_cols() %>%
select(!race)
study123_dummies <- bind_cols(study123, race_dummies)
dum_sum <- study123_dummies %>%
group_by(identity, name) %>%
summarize(white_pct = mean(race_White, na.rm = TRUE),
asian_pct = mean(`race_Asian or Pacific Islander`, na.rm = TRUE),
black_pct = mean(`race_Black or African American`),
latino_pct = mean(race_Hispanic),
other_pct = mean(race_Other))
# CSV
write_csv(dum_sum, here("data_outputs", "names_race_perception.csv"))
# RDS
write_rds(dum_sum, here("data_outputs", "names_race_perception.rds"))
group_group_plot <- map2_dfr(c("Black", "White", "AAPI", "Latino"), c("Black", "White", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(title = glue("Within group assessment:
A group member assesses their own group's names"),
x = "Respondent/Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
white_other_plot <- map2_dfr(c("White", "White", "White"), c("Black", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = identity, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(title = glue("Between group assessment:
A white assesses other racial group members' names"),
x = "Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
other_white_plot <- map2_dfr(c("Black", "AAPI", "Latino"), c("White", "White", "White"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(title = glue("Between group assessment:
A non-white assesses whites' names"),
x = "Respondent", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
high_quality_group_group_names <- map2_dfr(c("Black", "White", "AAPI", "Latino"), c("Black", "White", "AAPI", "Latino"), better_than_mean_names)
high_quality_group_group_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_group_group_names, here("data_outputs", "hq_group_group_names.csv"))
# RDS
write_rds(high_quality_group_group_names, here("data_outputs", "hq_group_group_names.rds"))
high_quality_white_other_names <- map2_dfr(rep("White", 3),  c("Black", "AAPI", "Latino"), better_than_mean_names)
high_quality_white_other_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_white_other_names, here("data_outputs", "hq_white_other_names.csv"))
# RDS
write_rds(high_quality_white_other_names, here("data_outputs", "hq_white_other_names.rds"))
high_quality_other_white_names <- map2_dfr(c("Black", "AAPI", "Latino"), rep("White", 3), better_than_mean_names)
high_quality_other_white_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_other_white_names, here("data_outputs", "hq_other_white_names.csv"))
# RDS
write_rds(high_quality_other_white_names, here("data_outputs", "hq_other_white_names.rds"))
study123$income.ord <- normalize(study123$income.ord)
study123$education.ord <- normalize(study123$education.ord)
# identity values = "Black or African American," "White," "Asian or Pacific Islander," "Hispanic"
summ123 <- study123 %>%
group_by(identity, w.asian, name) %>%
summarize(Correct = mean(correct),
Citizen = mean(citizen),
Education = mean(education.ord, na.rm = T),
Income = mean(income.ord, na.rm = T))
mod_black <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Black or African American")) %>%
tidy() %>%
mutate(identity = "Black")
mod_white <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "White")) %>%
tidy() %>%
mutate(identity = "White")
mod_asian <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Asian or Pacific Islander")) %>%
tidy() %>%
mutate(identity = "Asian")
mod_wasian <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 1 & identity == "Asian or Pacific Islander")) %>%
tidy() %>%
mutate(identity = "Asian (White first name)")
mod_latino <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Hispanic")) %>%
tidy() %>%
mutate(identity = "Latino")
all_mod <- bind_rows(mod_asian, mod_black, mod_latino, mod_wasian, mod_white)
all_mod %>%
filter(!str_detect(term, "Inter")) %>%
ggplot(aes(x = term,
y = estimate,
ymax = conf.high,
ymin = conf.low,
label = round(estimate, 2))) +
geom_pointrange() +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(x = "", y = "Estimate") +
facet_wrap(~identity) +
geom_text_repel()
ggsave(here("plots", "estimate_by_race.png"))
diff_res <- reduce(list(diff_summ("citizen", "citizen"),
diff_summ("education.ord", "education"),
diff_summ("income.ord", "income")),
full_join)
pct_correct_df <- study123 %>%
ungroup() %>%
select(identity, w.asian, name, correct) %>%
group_by(identity, w.asian, name) %>%
summarize(pct_correct = mean(correct))
diff_pct_correct <- left_join(diff_res, pct_correct_df)
# CSV
write_csv(diff_pct_correct, here("data_outputs", "pct_correct_covariate.csv"))
# RDS
write_rds(diff_pct_correct, here("data_outputs", "pct_correct_covariate.rds"))
