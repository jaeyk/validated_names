ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A non-white assesses whites' names"),
x = "Respondent", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
# R CRAN packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, glue, purrr, ggsci, ggthemes, patchwork, ggrepel, ggpubr, estimatr, fastDummies)
ggplot2::theme_set(ggplot2::theme_bw())
# Custom functions
source(here("functions", "validate.r"))
source(here("functions", "utils.r"))
load(file = here("data_outputs", "study123.rda"))
study23 <- full_join(study2, study3)
study23 <- study23 %>%
mutate(identity = recode(identity,
"Black or African American" = "Black",
"Asian or Pacific Islander" = "AAPI",
"Hispanic" = "Latino"
))
study123 <- full_join(study1, study2) %>%
full_join(study3)
race_dummies <- study123 %>%
select(race) %>%
dummy_cols() %>%
select(!race)
study123_dummies <- bind_cols(study123, race_dummies)
dum_sum <- study123_dummies %>%
group_by(identity, name) %>%
summarize(white_pct = mean(race_White, na.rm = TRUE),
asian_pct = mean(`race_Asian or Pacific Islander`, na.rm = TRUE),
black_pct = mean(`race_Black or African American`),
latino_pct = mean(race_Hispanic),
other_pct = mean(race_Other))
# CSV
write_csv(dum_sum, here("data_outputs", "names_race_perception.csv"))
# RDS
write_rds(dum_sum, here("data_outputs", "names_race_perception.rds"))
group_group_plot <- map2_dfr(c("Black", "White", "AAPI", "Latino"), c("Black", "White", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Within group assessment:
#A group member assesses their own group's names"),
x = "Respondent/Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
white_other_plot <- map2_dfr(c("White", "White", "White"), c("Black", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = identity, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A white assesses other racial group members' names"),
x = "Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
other_white_plot <- map2_dfr(c("Black", "AAPI", "Latino"), c("White", "White", "White"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A non-white assesses whites' names"),
x = "Respondent", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1)) +
geom_text_repel()
fig3 + patchwork::plot_annotation(tag_level = "A")
FIGURE 3 #################
fig3 <- group_group_plot /
white_other_plot /
other_white_plot
fig3 + patchwork::plot_annotation(tag_level = "A")
fig3 + patchwork::plot_annotation(tag_level = "A")
fig3
fig3 + patchwork::plot_annotation(tag_level = "A")
# R CRAN packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, glue, purrr, ggsci, ggthemes, patchwork, ggrepel, ggpubr, estimatr, fastDummies)
ggplot2::theme_set(ggplot2::theme_bw())
# Custom functions
source(here("functions", "validate.r"))
source(here("functions", "utils.r"))
load(file = here("data_outputs", "study123.rda"))
study23 <- full_join(study2, study3)
study23 <- study23 %>%
mutate(identity = recode(identity,
"Black or African American" = "Black",
"Asian or Pacific Islander" = "AAPI",
"Hispanic" = "Latino"
))
study123 <- full_join(study1, study2) %>%
full_join(study3)
race_dummies <- study123 %>%
select(race) %>%
dummy_cols() %>%
select(!race)
study123_dummies <- bind_cols(study123, race_dummies)
dum_sum <- study123_dummies %>%
group_by(identity, name) %>%
summarize(white_pct = mean(race_White, na.rm = TRUE),
asian_pct = mean(`race_Asian or Pacific Islander`, na.rm = TRUE),
black_pct = mean(`race_Black or African American`),
latino_pct = mean(race_Hispanic),
other_pct = mean(race_Other))
# CSV
write_csv(dum_sum, here("data_outputs", "names_race_perception.csv"))
# RDS
write_rds(dum_sum, here("data_outputs", "names_race_perception.rds"))
group_group_plot <- map2_dfr(c("Black", "White", "AAPI", "Latino"), c("Black", "White", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Within group assessment:
#A group member assesses their own group's names"),
x = "Respondent/Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
white_other_plot <- map2_dfr(c("White", "White", "White"), c("Black", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = identity, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A white assesses other racial group members' names"),
x = "Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
other_white_plot <- map2_dfr(c("Black", "AAPI", "Latino"), c("White", "White", "White"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A non-white assesses whites' names"),
x = "Respondent", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
fig3 <- group_group_plot /
white_other_plot /
other_white_plot +patchwork::plot_annotation(tag_level = "A")
fig3
fig3
ggsave(here("plots", "res_race_identity_correspondence.jpg"),
width = 7,
height = 8)
# for publication
ggsave(here("plots", "figure3.eps"),
width = 8,
height = 10,
device = "eps")
---
title: "Validate the datasets"
# R CRAN packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, glue, purrr, ggsci, ggthemes, patchwork, ggrepel, ggpubr, estimatr, fastDummies)
ggplot2::theme_set(ggplot2::theme_bw())
# Custom functions
source(here("functions", "validate.r"))
source(here("functions", "utils.r"))
load(file = here("data_outputs", "study123.rda"))
study23 <- full_join(study2, study3)
study23 <- study23 %>%
mutate(identity = recode(identity,
"Black or African American" = "Black",
"Asian or Pacific Islander" = "Asian",
"Hispanic" = "Hispanic"
))
study123 <- full_join(study1, study2) %>%
full_join(study3)
race_dummies <- study123 %>%
select(race) %>%
dummy_cols() %>%
select(!race)
study123_dummies <- bind_cols(study123, race_dummies)
dum_sum <- study123_dummies %>%
group_by(identity, name) %>%
summarize(white_pct = mean(race_White, na.rm = TRUE),
asian_pct = mean(`race_Asian or Pacific Islander`, na.rm = TRUE),
black_pct = mean(`race_Black or African American`),
Hispanic_pct = mean(race_Hispanic),
other_pct = mean(race_Other))
# CSV
write_csv(dum_sum, here("data_outputs", "names_race_perception.csv"))
# RDS
write_rds(dum_sum, here("data_outputs", "names_race_perception.rds"))
group_group_plot <- map2_dfr(c("Black", "White", "Asian", "Hispanic"), c("Black", "White", "Asian", "Hispanic"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Within group assessment:
#A group member assesses their own group's names"),
x = "Respondent/Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
white_other_plot <- map2_dfr(c("White", "White", "White"), c("Black", "Asian", "Hispanic"), sum_last_first_names) %>%
ggplot(aes(x = identity, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A white assesses other racial group members' names"),
x = "Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
other_white_plot <- map2_dfr(c("Black", "Asian", "Hispanic"), c("White", "White", "White"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A non-white assesses whites' names"),
x = "Respondent", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
high_quality_group_group_names <- map2_dfr(c("Black", "White", "Asian", "Hispanic"), c("Black", "White", "Asian", "Hispanic"), better_than_mean_names)
high_quality_group_group_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_group_group_names, here("data_outputs", "hq_group_group_names.csv"))
# RDS
write_rds(high_quality_group_group_names, here("data_outputs", "hq_group_group_names.rds"))
high_quality_white_other_names <- map2_dfr(rep("White", 3),  c("Black", "Asian", "Hispanic"), better_than_mean_names)
high_quality_white_other_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_white_other_names, here("data_outputs", "hq_white_other_names.csv"))
# RDS
write_rds(high_quality_white_other_names, here("data_outputs", "hq_white_other_names.rds"))
high_quality_other_white_names <- map2_dfr(c("Black", "Asian", "Hispanic"), rep("White", 3), better_than_mean_names)
high_quality_other_white_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_other_white_names, here("data_outputs", "hq_other_white_names.csv"))
# RDS
write_rds(high_quality_other_white_names, here("data_outputs", "hq_other_white_names.rds"))
study123$income.ord <- normalize(study123$income.ord)
study123$education.ord <- normalize(study123$education.ord)
# identity values = "Black or African American," "White," "Asian or Pacific Islander," "Hispanic"
summ123 <- study123 %>%
group_by(identity, w.asian, name) %>%
summarize(Correct = mean(correct),
Citizen = mean(citizen),
Education = mean(education.ord, na.rm = T),
Income = mean(income.ord, na.rm = T))
mod_black <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Black or African American")) %>%
tidy() %>%
mutate(identity = "Black")
mod_white <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "White")) %>%
tidy() %>%
mutate(identity = "White")
mod_asian <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Asian or Pacific Islander")) %>%
tidy() %>%
mutate(identity = "Asian")
mod_wasian <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 1 & identity == "Asian or Pacific Islander")) %>%
tidy() %>%
mutate(identity = "Asian (White first name)")
mod_Hispanic <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Hispanic")) %>%
tidy() %>%
mutate(identity = "Hispanic")
all_mod <- bind_rows(mod_asian, mod_black, mod_Hispanic, mod_wasian, mod_white)
all_mod %>%
filter(!str_detect(term, "Inter")) %>%
ggplot(aes(x = term,
y = estimate,
ymax = conf.high,
ymin = conf.low,
label = round(estimate, 2))) +
geom_pointrange() +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(x = "", y = "Estimate") +
facet_wrap(~identity) +
geom_text_repel()
ggsave(here("plots", "estimate_by_race.jpg"))
diff_res <- reduce(list(diff_summ("citizen", "citizen"),
diff_summ("education.ord", "education"),
diff_summ("income.ord", "income")),
full_join)
pct_correct_df <- study123 %>%
ungroup() %>%
select(identity, w.asian, name, correct) %>%
group_by(identity, w.asian, name) %>%
summarize(pct_correct = mean(correct))
diff_pct_correct <- left_join(diff_res, pct_correct_df)
# CSV
write_csv(diff_pct_correct, here("data_outputs", "pct_correct_covariate.csv"))
# RDS
write_rds(diff_pct_correct, here("data_outputs", "pct_correct_covariate.rds"))
group_group_plot <- map2_dfr(c("Black", "White", "Asian", "Hispanic"), c("Black", "White", "Asian", "Hispanic"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Within group assessment:
#A group member assesses their own group's names"),
x = "Respondent/Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
group_group_plot
---
title: "Validate the datasets"
# R CRAN packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, glue, purrr, ggsci, ggthemes, patchwork, ggrepel, ggpubr, estimatr, fastDummies)
ggplot2::theme_set(ggplot2::theme_bw())
# Custom functions
source(here("functions", "validate.r"))
source(here("functions", "utils.r"))
load(file = here("data_outputs", "study123.rda"))
study23 <- full_join(study2, study3)
study23 <- study23 %>%
mutate(identity = recode(identity,
"Black or African American" = "Black",
"Asian or Pacific Islander" = "AAPI",
"Hispanic" = "Latino"
))
study123 <- full_join(study1, study2) %>%
full_join(study3)
race_dummies <- study123 %>%
select(race) %>%
dummy_cols() %>%
select(!race)
study123_dummies <- bind_cols(study123, race_dummies)
dum_sum <- study123_dummies %>%
group_by(identity, name) %>%
summarize(white_pct = mean(race_White, na.rm = TRUE),
asian_pct = mean(`race_Asian or Pacific Islander`, na.rm = TRUE),
black_pct = mean(`race_Black or African American`),
latino_pct = mean(race_Hispanic),
other_pct = mean(race_Other))
# CSV
write_csv(dum_sum, here("data_outputs", "names_race_perception.csv"))
# RDS
write_rds(dum_sum, here("data_outputs", "names_race_perception.rds"))
group_group_plot <- map2_dfr(c("Black", "White", "AAPI", "Latino"), c("Black", "White", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Within group assessment:
#A group member assesses their own group's names"),
x = "Respondent/Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
white_other_plot <- map2_dfr(c("White", "White", "White"), c("Black", "AAPI", "Latino"), sum_last_first_names) %>%
ggplot(aes(x = identity, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A white assesses other racial group members' names"),
x = "Name", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
other_white_plot <- map2_dfr(c("Black", "AAPI", "Latino"), c("White", "White", "White"), sum_last_first_names) %>%
ggplot(aes(x = res.race, y = mean_correct,
ymax = mean_correct + 1.96*se_correct,
ymin = mean_correct - 1.96*se_correct,
label = round(mean_correct, 2))) +
geom_pointrange() +
facet_wrap(~`Name type`) +
labs(#title = glue("Between group assessment:
#A non-white assesses whites' names"),
x = "Respondent", y = "% correct") +
geom_hline(yintercept = 0.5, linetype = "dashed") +
ylim(c(0.3 , 1))
high_quality_group_group_names <- map2_dfr(c("Black", "White", "AAPI", "Latino"), c("Black", "White", "AAPI", "Latino"), better_than_mean_names)
high_quality_group_group_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_group_group_names, here("data_outputs", "hq_group_group_names.csv"))
# RDS
write_rds(high_quality_group_group_names, here("data_outputs", "hq_group_group_names.rds"))
high_quality_white_other_names <- map2_dfr(rep("White", 3),  c("Black", "AAPI", "Latino"), better_than_mean_names)
high_quality_white_other_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_white_other_names, here("data_outputs", "hq_white_other_names.csv"))
# RDS
write_rds(high_quality_white_other_names, here("data_outputs", "hq_white_other_names.rds"))
high_quality_other_white_names <- map2_dfr(c("Black", "AAPI", "Latino"), rep("White", 3), better_than_mean_names)
high_quality_other_white_names %>%
select(res.race, identity, pct_quality_names) %>%
distinct()
# CSV
write_csv(high_quality_other_white_names, here("data_outputs", "hq_other_white_names.csv"))
# RDS
write_rds(high_quality_other_white_names, here("data_outputs", "hq_other_white_names.rds"))
study123$income.ord <- normalize(study123$income.ord)
study123$education.ord <- normalize(study123$education.ord)
# identity values = "Black or African American," "White," "Asian or Pacific Islander," "Hispanic"
summ123 <- study123 %>%
group_by(identity, w.asian, name) %>%
summarize(Correct = mean(correct),
Citizen = mean(citizen),
Education = mean(education.ord, na.rm = T),
Income = mean(income.ord, na.rm = T))
mod_black <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Black or African American")) %>%
tidy() %>%
mutate(identity = "Black")
mod_white <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "White")) %>%
tidy() %>%
mutate(identity = "White")
mod_asian <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Asian or Pacific Islander")) %>%
tidy() %>%
mutate(identity = "Asian")
mod_wasian <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 1 & identity == "Asian or Pacific Islander")) %>%
tidy() %>%
mutate(identity = "Asian (White first name)")
mod_latino <- lm_robust(Correct ~ Citizen + Education + Income, data = subset(summ123, w.asian == 0 & identity == "Hispanic")) %>%
tidy() %>%
mutate(identity = "Latino")
all_mod <- bind_rows(mod_asian, mod_black, mod_latino, mod_wasian, mod_white)
all_mod %>%
filter(!str_detect(term, "Inter")) %>%
ggplot(aes(x = term,
y = estimate,
ymax = conf.high,
ymin = conf.low,
label = round(estimate, 2))) +
geom_pointrange() +
coord_flip() +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(x = "", y = "Estimate") +
facet_wrap(~identity) +
geom_text_repel()
ggsave(here("plots", "estimate_by_race.jpg"))
diff_res <- reduce(list(diff_summ("citizen", "citizen"),
diff_summ("education.ord", "education"),
diff_summ("income.ord", "income")),
full_join)
pct_correct_df <- study123 %>%
ungroup() %>%
select(identity, w.asian, name, correct) %>%
group_by(identity, w.asian, name) %>%
summarize(pct_correct = mean(correct))
diff_pct_correct <- left_join(diff_res, pct_correct_df)
# CSV
write_csv(diff_pct_correct, here("data_outputs", "pct_correct_covariate.csv"))
# RDS
write_rds(diff_pct_correct, here("data_outputs", "pct_correct_covariate.rds"))
install.packages(c("bookdown", "broom", "bslib", "evaluate", "future", "htmlwidgets", "httpuv", "lhs", "listenv", "maptools", "pagedown", "parallelly", "pkgdown", "progressr", "rgdal", "rmarkdown", "shiny", "tidycensus", "tigris", "tinytex", "tm", "xaringan"))
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, readxl)
here("tables")
list.files(here("tables"))
file_name <- list.files(here("tables"))
tb <- readxl::read_excel(here("tables", file_name))
# read excel pkg
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, readxl)
# import files
file_name <- list.files(here("tables"))
tb <- readxl::read_excel(here("tables", file_name))
tb
tb$Date[1] <- "February 4, 2021"
tb
?read_excel
tb1 <- readxl::read_excel(here("tables", file_name),
sheet = 1)
tb2 <- readxl::read_excel(here("tables", file_name),
sheet = 2)
tb3 <- readxl::read_excel(here("tables", file_name),
sheet = 3)
tb1$Date[1] <- "February 4, 2021"
tb1
tb2
tb3
write_csv(tb1, here("tables", "tb1.csv"))
write_csv(tb2, here("tables", "tb2.csv"))
write_csv(tb3, here("tables", "tb3.csv"))
